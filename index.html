<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <title>Cleiton PRO v9.3</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#0f172a', surface: '#ffffff' },
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; -webkit-tap-highlight-color: transparent; user-select: none; }
        .page-container { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .page-active { display: block; opacity: 1; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        
        #pocket-mode-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000; z-index: 9999; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            color: #333;
        }

        .loading-shimmer {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="bg-slate-100 h-screen flex flex-col overflow-hidden">

    <!-- CABEÇALHO -->
    <header class="bg-primary text-white pt-safe-top pb-4 px-6 shadow-lg z-20 shrink-0">
        <div class="flex justify-between items-center mt-3">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600/20 p-2 rounded-lg">
                    <i class="ph-fill ph-truck text-2xl text-blue-400"></i>
                </div>
                <div>
                    <h1 class="font-black text-lg leading-none">Cleiton<span class="text-blue-500">PRO</span></h1>
                    <p id="system-status" class="text-[9px] text-green-400 uppercase font-bold mt-1 tracking-wider">GPS Tracker v9.3</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-[9px] text-slate-400 uppercase font-bold">Odómetro Atual</p>
                <p id="header-odometer" class="text-lg font-mono font-black text-white tracking-widest">---</p>
            </div>
        </div>
    </header>

    <!-- MODO BOLSO -->
    <div id="pocket-mode-overlay">
        <i class="ph-fill ph-lock-key text-6xl mb-4 animate-pulse"></i>
        <p class="text-xs font-bold uppercase tracking-widest mb-10 text-zinc-500">Modo Bolso Ativo</p>
        <div class="text-center">
            <p class="text-5xl font-black text-zinc-900" id="pocket-dist">0.00</p>
            <p class="text-[10px] text-zinc-600 uppercase font-bold mt-2">Toque 2x para sair</p>
        </div>
    </div>

    <!-- CONTEÚDO -->
    <main class="flex-1 overflow-y-auto pb-24 relative">
        <div id="view-home" class="page-container page-active p-5 space-y-4">
            <!-- DISPLAY PRINCIPAL -->
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-slate-200 text-center relative overflow-hidden">
                <div id="recording-indicator" class="hidden absolute top-0 left-0 w-full h-1 bg-red-500 animate-pulse"></div>
                
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Percorrido nesta viagem</p>
                <div class="flex justify-center items-baseline gap-1 mb-6">
                    <h2 id="live-distance" class="text-7xl font-black text-slate-800 tracking-tighter">0.00</h2>
                    <span class="text-xl font-bold text-slate-400">km</span>
                </div>

                <div class="flex justify-center gap-4">
                    <button id="btn-gps" onclick="toggleGPS()" class="h-20 w-20 bg-primary rounded-2xl text-white shadow-xl flex items-center justify-center active:scale-95 transition-all">
                        <i id="icon-play" class="ph-fill ph-play text-3xl"></i>
                        <i id="icon-stop" class="ph-fill ph-stop text-3xl hidden"></i>
                    </button>
                    <button id="btn-pocket" onclick="enablePocketMode()" class="h-20 w-20 bg-slate-100 rounded-2xl text-slate-400 border border-slate-200 flex flex-col items-center justify-center disabled:opacity-30" disabled>
                        <i class="ph-fill ph-moon text-2xl mb-1"></i>
                        <span class="text-[9px] font-bold uppercase">Bolso</span>
                    </button>
                </div>

                <div class="mt-6 space-y-2">
                    <div class="flex items-center justify-center gap-2 text-[10px] font-bold text-slate-400 uppercase">
                        <i class="ph-fill ph-map-pin text-blue-500"></i>
                        <span>Origem:</span>
                        <span id="live-origin-addr" class="text-slate-600 truncate max-w-[150px]">Aguardando início...</span>
                    </div>
                </div>
            </div>

            <!-- DASHBOARD -->
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-primary text-white p-4 rounded-2xl shadow-lg">
                    <p class="text-[10px] font-bold text-blue-300 uppercase">Gasto Total</p>
                    <p id="dash-total-cost" class="text-2xl font-black">R$ 0,00</p>
                </div>
                <div class="bg-white p-4 rounded-2xl border border-slate-200">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Consumo Total</p>
                    <p id="dash-total-liters" class="text-2xl font-black text-slate-800">0.0</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white p-4 rounded-2xl border border-slate-200">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">KM Percorridos</p>
                    <p id="dash-total-km" class="text-2xl font-black text-slate-800">0.0</p>
                </div>
                <div class="bg-white p-4 rounded-2xl border border-slate-200">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Total Viagens</p>
                    <p id="dash-trips-count" class="text-2xl font-black text-slate-800">0</p>
                </div>
            </div>
        </div>

        <!-- FORMULÁRIO DE REGISTRO -->
        <div id="view-register" class="page-container p-5">
            <h2 class="text-xl font-black text-slate-800 mb-4">Salvar Trajeto</h2>
            <form id="route-form" class="bg-white rounded-3xl p-5 shadow-sm border border-slate-200 space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Data</label>
                        <input type="date" id="form-date" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs font-bold">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Responsável</label>
                        <input type="text" id="form-resp" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs font-bold" placeholder="Nome">
                    </div>
                </div>

                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase">Tipo de Serviço</label>
                    <select id="form-service" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs font-bold">
                        <option value="Manutenção">Manutenção</option>
                        <option value="Instalação">Instalação</option>
                        <option value="Fibra Óptica">Lançamento de Fibra</option>
                        <option value="Vistoria">Vistoria</option>
                    </select>
                </div>

                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-3">
                    <div class="space-y-1">
                        <label class="text-[9px] font-black text-blue-500 uppercase">Origem (GPS)</label>
                        <div class="flex items-center gap-2">
                            <i class="ph ph-map-pin-line text-blue-500"></i>
                            <input type="text" id="form-start" class="w-full bg-transparent text-xs font-bold" placeholder="Local de partida">
                        </div>
                    </div>
                    <hr class="border-slate-200">
                    <div class="space-y-1">
                        <label class="text-[9px] font-black text-green-500 uppercase">Destino (GPS)</label>
                        <div class="flex items-center gap-2">
                            <i class="ph ph-flag-checkered text-green-500"></i>
                            <input type="text" id="form-end" class="w-full bg-transparent text-xs font-bold" placeholder="Local de chegada">
                        </div>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[9px] font-black text-blue-400 uppercase">Odómetro Inicial</label>
                        <input type="number" id="form-km-init" class="w-full bg-white rounded-lg p-2 text-sm font-black" readonly>
                    </div>
                    <div>
                        <label class="text-[9px] font-black text-blue-600 uppercase">Final (Arredondado)</label>
                        <input type="number" id="form-km-final" step="1" class="w-full bg-white border-2 border-blue-500 rounded-lg p-2 text-sm font-black" onchange="applyRounding(this)">
                    </div>
                </div>

                <div class="flex gap-2 pt-2">
                    <button type="button" onclick="navTo('view-home')" class="px-4 py-4 rounded-xl bg-slate-100 text-slate-500 font-bold text-xs">Descartar</button>
                    <button type="submit" class="flex-1 py-4 rounded-xl bg-blue-600 text-white font-bold text-xs shadow-lg">CONCLUIR E SALVAR</button>
                </div>
            </form>
        </div>

        <!-- HISTÓRICO -->
        <div id="view-history" class="page-container p-5 space-y-4">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-black text-slate-800">Relatórios</h2>
                <button onclick="exportToExcel()" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-xl text-[10px] font-bold shadow-lg">
                    <i class="ph-fill ph-file-xls text-base"></i> EXCEL
                </button>
            </div>
            <div id="history-list" class="space-y-3 pb-20"></div>
        </div>

        <!-- CONFIGURAÇÕES -->
        <div id="view-settings" class="page-container p-5 space-y-6">
            <h2 class="text-xl font-black text-slate-800">Ajustes do Sistema</h2>
            
            <div class="bg-white p-5 rounded-3xl border border-slate-200 space-y-4">
                <div class="flex items-center gap-2 mb-2">
                    <i class="ph ph-gauge text-blue-500 font-bold"></i>
                    <h3 class="text-xs font-black uppercase text-slate-400">Ajustar Odómetro do Carro</h3>
                </div>
                <input type="number" id="config-odometer" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-lg font-black" placeholder="KM Atual">
                <button onclick="saveSettings()" class="w-full bg-primary text-white py-3 rounded-xl text-xs font-bold">ATUALIZAR KM</button>
            </div>

            <div class="bg-white p-5 rounded-3xl border border-slate-200 space-y-4">
                <div class="flex items-center gap-2 mb-2">
                    <i class="ph ph-gas-pump text-orange-500 font-bold"></i>
                    <h3 class="text-xs font-black uppercase text-slate-400">Consumo e Preço</h3>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[9px] font-bold text-slate-400 uppercase ml-1">KM por Litro</label>
                        <input type="number" id="config-kml" step="0.1" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm font-black">
                    </div>
                    <div>
                        <label class="text-[9px] font-bold text-slate-400 uppercase ml-1">Preço Litro (R$)</label>
                        <input type="number" id="config-fuel-price" step="0.01" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm font-black">
                    </div>
                </div>
                <button onclick="saveAutonomy()" class="w-full bg-orange-500 text-white py-3 rounded-xl text-xs font-bold">SALVAR TAXAS</button>
            </div>

            <button onclick="hardReset()" class="w-full text-red-500 text-[10px] font-bold uppercase mt-10 opacity-40 underline">Limpar todos os dados</button>
        </div>
    </main>

    <!-- NAVEGAÇÃO -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-slate-200 safe-bottom z-30">
        <div class="grid grid-cols-4 h-16">
            <button onclick="navTo('view-home')" class="nav-btn text-blue-600 flex flex-col items-center justify-center gap-1" data-target="view-home">
                <i class="ph-fill ph-navigation-arrow text-2xl"></i>
                <span class="text-[9px] font-bold uppercase">Início</span>
            </button>
            <button onclick="navTo('view-register')" class="nav-btn text-slate-400 flex flex-col items-center justify-center gap-1" data-target="view-register">
                <i class="ph-fill ph-plus-circle text-2xl"></i>
                <span class="text-[9px] font-bold uppercase">Novo</span>
            </button>
            <button onclick="navTo('view-history')" class="nav-btn text-slate-400 flex flex-col items-center justify-center gap-1" data-target="view-history">
                <i class="ph-fill ph-list-dashes text-2xl"></i>
                <span class="text-[9px] font-bold uppercase">Logs</span>
            </button>
            <button onclick="navTo('view-settings')" class="nav-btn text-slate-400 flex flex-col items-center justify-center gap-1" data-target="view-settings">
                <i class="ph-fill ph-gear text-2xl"></i>
                <span class="text-[9px] font-bold uppercase">Config</span>
            </button>
        </div>
    </nav>

    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full text-xs font-bold shadow-2xl transition-transform -translate-y-20 z-50">Notificação</div>

    <script>
        const DB_KEY = 'CLEITON_V93_GEO_ARRED';
        const INITIAL_ODOMETER = 244649;
        
        let db = {
            config: { odometer: INITIAL_ODOMETER, kml: 12.0, fuelPrice: 5.79 },
            routes: []
        };

        let gpsState = {
            active: false,
            watchId: null,
            totalDistance: 0,
            lastLat: null, lastLng: null,
            wakeLock: null,
            originAddr: "",
            destAddr: ""
        };

        window.onload = function() {
            const saved = localStorage.getItem(DB_KEY);
            if (saved) db = JSON.parse(saved);
            updateUI();
        };

        function saveData() {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            updateUI();
        }

        function applyRounding(input) {
            if(input.value) {
                input.value = Math.ceil(parseFloat(input.value));
            }
        }

        function toggleGPS() {
            if (!gpsState.active) startGPS();
            else stopGPS();
        }

        async function startGPS() {
            if (!navigator.geolocation) return showToast("GPS Indisponível");
            
            showToast("Iniciando GPS...");
            gpsState.active = true;
            gpsState.totalDistance = 0;
            gpsState.lastLat = null;
            gpsState.lastLng = null;
            
            document.getElementById('btn-gps').classList.replace('bg-primary', 'bg-red-500');
            document.getElementById('icon-play').classList.add('hidden');
            document.getElementById('icon-stop').classList.remove('hidden');
            document.getElementById('btn-pocket').disabled = false;
            document.getElementById('recording-indicator').classList.remove('hidden');

            try { if ('wakeLock' in navigator) gpsState.wakeLock = await navigator.wakeLock.request('screen'); } catch(e){}

            // Captura Endereço de Origem no exato momento do clique
            navigator.geolocation.getCurrentPosition(async p => {
                const addr = await getAddress(p.coords.latitude, p.coords.longitude);
                gpsState.originAddr = addr;
                document.getElementById('live-origin-addr').textContent = addr;
                document.getElementById('form-start').value = addr;
            });

            gpsState.watchId = navigator.geolocation.watchPosition((pos) => {
                const { latitude, longitude, accuracy } = pos.coords;
                if (accuracy > 50) return; // Ignorar sinal ruim
                
                if (gpsState.lastLat !== null) {
                    const d = calculateDistance(gpsState.lastLat, gpsState.lastLng, latitude, longitude);
                    if (d > 0.003) { // Filtro de movimento mínimo (3 metros)
                        gpsState.totalDistance += d;
                        document.getElementById('live-distance').textContent = gpsState.totalDistance.toFixed(2);
                        document.getElementById('pocket-dist').textContent = gpsState.totalDistance.toFixed(2);
                    }
                }
                gpsState.lastLat = latitude;
                gpsState.lastLng = longitude;
            }, null, { enableHighAccuracy: true });
        }

        async function stopGPS() {
            gpsState.active = false;
            if (gpsState.watchId) navigator.geolocation.clearWatch(gpsState.watchId);
            if (gpsState.wakeLock) { gpsState.wakeLock.release(); gpsState.wakeLock = null; }

            document.getElementById('btn-gps').classList.replace('bg-red-500', 'bg-primary');
            document.getElementById('icon-play').classList.remove('hidden');
            document.getElementById('icon-stop').classList.add('hidden');
            document.getElementById('recording-indicator').classList.add('hidden');

            // Captura Endereço de Destino no momento do stop
            if (gpsState.lastLat) {
                const finalAddr = await getAddress(gpsState.lastLat, gpsState.lastLng);
                gpsState.destAddr = finalAddr;
                document.getElementById('form-end').value = finalAddr;
            }

            const kmPercorrido = gpsState.totalDistance;
            const finalKM_raw = db.config.odometer + kmPercorrido;

            document.getElementById('form-km-init').value = db.config.odometer;
            // ARREDONDAMENTO OBRIGATÓRIO PARA CIMA
            document.getElementById('form-km-final').value = Math.ceil(finalKM_raw);
            document.getElementById('form-date').value = new Date().toISOString().split('T')[0];

            navTo('view-register');
        }

        async function getAddress(lat, lng) {
            try {
                // Usando Nominatim (OpenStreetMap) para Geocodificação Reversa
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18`);
                const data = await res.json();
                if (data.display_name) {
                    // Limpar endereço para ficar mais curto (Rua + Número/Bairro)
                    const parts = data.display_name.split(',');
                    return parts[0] + (parts[1] ? ', ' + parts[1] : '');
                }
                return `Lat: ${lat.toFixed(4)}, Lon: ${lng.toFixed(4)}`;
            } catch (e) { 
                return `Ponto ${lat.toFixed(4)}`; 
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Raio da Terra em KM
            const dLat = (lat2-lat1)*Math.PI/180;
            const dLon = (lon2-lon1)*Math.PI/180;
            const a = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        function navTo(id) {
            document.querySelectorAll('.page-container').forEach(v => v.classList.remove('page-active'));
            document.getElementById(id).classList.add('page-active');
            document.querySelectorAll('.nav-btn').forEach(b => {
                if(b.dataset.target === id) b.classList.replace('text-slate-400', 'text-blue-600');
                else b.classList.replace('text-blue-600', 'text-slate-400');
            });
        }

        document.getElementById('route-form').onsubmit = (e) => {
            e.preventDefault();
            const init = parseFloat(document.getElementById('form-km-init').value);
            // Garante arredondamento final antes de salvar
            const final = Math.ceil(parseFloat(document.getElementById('form-km-final').value));
            
            if(final < init) {
                showToast("Erro: KM final não pode ser menor!");
                return;
            }

            db.routes.unshift({
                id: Date.now(),
                date: document.getElementById('form-date').value,
                responsible: document.getElementById('form-resp').value || "Cleiton",
                service: document.getElementById('form-service').value,
                start: document.getElementById('form-start').value,
                end: document.getElementById('form-end').value,
                kmTotal: (final - init),
                cost: ((final - init) / db.config.kml * db.config.fuelPrice)
            });

            db.config.odometer = final;
            saveData();
            
            // Limpeza
            document.getElementById('route-form').reset();
            document.getElementById('live-distance').textContent = "0.00";
            document.getElementById('live-origin-addr').textContent = "Aguardando início...";
            
            navTo('view-history');
            showToast("Trajeto Salvo com Sucesso!");
        };

        function updateUI() {
            document.getElementById('header-odometer').textContent = Math.floor(db.config.odometer);
            document.getElementById('config-odometer').value = db.config.odometer;
            document.getElementById('config-kml').value = db.config.kml;
            document.getElementById('config-fuel-price').value = db.config.fuelPrice;
            
            const list = document.getElementById('history-list');
            list.innerHTML = db.routes.map(r => `
                <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm relative overflow-hidden">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-[9px] font-black text-blue-500 uppercase">${r.date}</span>
                            <p class="text-xs font-black text-slate-800">${r.service}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-black text-slate-800 leading-none">${r.kmTotal} <span class="text-[10px] text-slate-400">KM</span></p>
                            <p class="text-[10px] font-bold text-orange-600">R$ ${r.cost.toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="mt-3 space-y-1">
                        <div class="flex items-center gap-1 text-[9px] text-slate-400 font-bold uppercase truncate">
                            <i class="ph ph-map-pin"></i> ${r.start || '---'}
                        </div>
                        <div class="flex items-center gap-1 text-[9px] text-slate-500 font-bold uppercase truncate">
                            <i class="ph ph-flag-checkered"></i> ${r.end || '---'}
                        </div>
                    </div>
                    <button onclick="deleteRoute(${r.id})" class="absolute bottom-4 right-4 text-slate-300 active:text-red-500"><i class="ph-bold ph-trash"></i></button>
                </div>
            `).join('');

            const totalKm = db.routes.reduce((acc, r) => acc + r.kmTotal, 0);
            const totalCost = db.routes.reduce((acc, r) => acc + r.cost, 0);

            document.getElementById('dash-trips-count').textContent = db.routes.length;
            document.getElementById('dash-total-km').textContent = totalKm.toFixed(0);
            document.getElementById('dash-total-liters').textContent = (totalKm / db.config.kml).toFixed(1);
            document.getElementById('dash-total-cost').textContent = `R$ ${totalCost.toFixed(2)}`;
        }

        function saveSettings() {
            const val = document.getElementById('config-odometer').value;
            if(val) {
                db.config.odometer = Math.ceil(parseFloat(val));
                saveData();
                showToast("Odómetro Sincronizado!");
            }
        }

        function saveAutonomy() {
            db.config.kml = parseFloat(document.getElementById('config-kml').value) || 12.0;
            db.config.fuelPrice = parseFloat(document.getElementById('config-fuel-price').value) || 5.79;
            saveData();
            showToast("Taxas Atualizadas!");
        }

        function deleteRoute(id) {
            if(confirm("Deseja excluir este registro do histórico?")) {
                db.routes = db.routes.filter(r => r.id !== id);
                saveData();
            }
        }

        function exportToExcel() {
            let csv = "Data;Responsavel;Servico;KM;Origem;Destino;Custo\n";
            db.routes.forEach(r => {
                csv += `${r.date};${r.responsible};${r.service};${r.kmTotal};"${r.start}";"${r.end}";${r.cost.toFixed(2)}\n`;
            });
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Relatorio_CleitonPRO_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
        }

        function enablePocketMode() {
            document.getElementById('pocket-mode-overlay').style.display = 'flex';
            let c = 0;
            document.getElementById('pocket-mode-overlay').onclick = () => {
                c++;
                if(c === 2) { document.getElementById('pocket-mode-overlay').style.display = 'none'; c = 0; }
                setTimeout(() => c = 0, 400);
            }
        }

        function showToast(m) {
            const t = document.getElementById('toast');
            t.textContent = m;
            t.classList.remove('-translate-y-20');
            setTimeout(() => t.classList.add('-translate-y-20'), 3000);
        }

        function hardReset() { if(confirm("CUIDADO: Isso apagará todo o histórico permanentemente! Continuar?")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>

